
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>åŒ¹å…‹çƒæŠ€èƒ½è©•é‡ç³»çµ±</title>
  <script src="https://cdn.jsdelivr.net/npm/preact@10.19.2/dist/preact.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/preact@10.19.2/hooks/dist/hooks.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
  <div id="app"></div>
  <script type="module">
    const { h, render } = preact;
    const { useState, useRef } = preactHooks;

    const skillItems = [
      "ç™¼çƒï¼ˆServeï¼‰", "æ¥ç™¼çƒï¼ˆReturnï¼‰", "ä¸å…‹çƒï¼ˆDinkï¼‰", "é«˜åŠçƒï¼ˆLobï¼‰", "æ“Šçƒè½åœ°çƒï¼ˆGroundstrokeï¼‰",
      "éé ‚çƒï¼ˆOverheadï¼‰", "æˆªæ“Šçƒï¼ˆVolleyï¼‰", "åæ‹æ§åˆ¶ï¼ˆBackhandï¼‰", "æ¨ç›´ç·šçƒï¼ˆPush Shotï¼‰",
      "æ”»æ“Šä¸å…‹çƒï¼ˆAttackable Dinkï¼‰", "Reseté˜²å®ˆï¼ˆResetï¼‰", "ä¸Šç¶²æ­¥ä¼ï¼ˆTransitionï¼‰",
      "Drop shotï¼ˆçŸ­ä¸å…‹ï¼‰", "Long Drop shotï¼ˆé•·ä¸å…‹ï¼‰", "æ‰“é»åˆ¤æ–·ï¼ˆShot Selectionï¼‰"
    ];

    function App() {
      const [studentName, setStudentName] = useState("");
      const [scores, setScores] = useState(Array(skillItems.length).fill(0));
      const [submitted, setSubmitted] = useState(false);
      const resultRef = useRef(null);

      const handleChange = (index, value) => {
        const newScores = [...scores];
        newScores[index] = parseInt(value) || 0;
        setScores(newScores);
      };

      const totalScore = scores.reduce((a, b) => a + b, 0);

      const getLevel = (score) => {
        if (score >= 135) return "ç´„ 4.0 ç´š";
        if (score >= 120) return "ç´„ 3.5 ç´š";
        if (score >= 100) return "ç´„ 3.0 ç´š";
        if (score >= 80) return "ç´„ 2.5 ç´š";
        return "ç´„ 2.0 ä»¥ä¸‹";
      };

      const getNextLevelGap = (score) => {
        if (score < 80) return `è·é›¢ 2.5 ç´šé‚„å·® ${80 - score} åˆ†`;
        if (score < 100) return `è·é›¢ 3.0 ç´šé‚„å·® ${100 - score} åˆ†`;
        if (score < 120) return `è·é›¢ 3.5 ç´šé‚„å·® ${120 - score} åˆ†`;
        if (score < 135) return `è·é›¢ 4.0 ç´šé‚„å·® ${135 - score} åˆ†`;
        return "å·²é”æœ€é«˜ç´šåˆ¥ï¼ç¹¼çºŒä¿æŒï¼";
      };

      const getSummary = () => {
        const topSkills = scores.map((score, i) => ({ score, skill: skillItems[i] })).filter(s => s.score >= 9).map(s => s.skill);
        const weakSkills = scores.map((score, i) => ({ score, skill: skillItems[i] })).filter(s => s.score < 5).map(s => s.skill);
        const isExcellent = topSkills.length > 5;
        return { topSkills, weakSkills, isExcellent };
      };

      const summary = getSummary();

      const handleShareScreenshot = async () => {
        if (!resultRef.current) return;
        const canvas = await html2canvas(resultRef.current);
        const dataUrl = canvas.toDataURL("image/png");
        const win = window.open();
        if (win && win.document) {
          win.document.write("<!DOCTYPE html><html><head><title>åˆ†äº«çµæœ</title></head><body style='text-align:center;'><img style='max-width:100%;' src='" + dataUrl + "'/></body></html>");
        } else {
          alert("ç€è¦½å™¨é™åˆ¶é–‹å•Ÿæ–°è¦–çª—ï¼Œè«‹å…è¨±å½ˆå‡ºè¦–çª—ä»¥é€²è¡Œåˆ†äº«");
        }
      };

      return h("div", { class: "max-w-4xl mx-auto space-y-6" },
        h("h1", { class: "text-2xl font-bold" }, "åŒ¹å…‹çƒæŠ€èƒ½è©•é‡ç³»çµ±"),
        h("div", { class: "flex flex-col sm:flex-row gap-4 mt-4" },
          h("div", { class: "flex items-center gap-2" },
            h("label", { class: "font-medium" }, "å­¸ç”Ÿå§“åï¼š"),
            h("input", {
              type: "text", value: studentName,
              onInput: e => setStudentName(e.target.value),
              class: "w-48 border rounded px-2 py-1"
            })
          ),
          h("div", { class: "flex items-center gap-2" },
            h("label", { class: "font-medium" }, "æ¸¬è©¦æ—¥æœŸï¼š"),
            h("span", null, new Date().toLocaleDateString())
          )
        ),
        !submitted && h("div", { class: "bg-white p-4 rounded shadow space-y-4" },
          skillItems.map((item, index) =>
            h("div", { class: "flex items-center space-x-4", key: index },
              h("label", { class: "w-64 font-medium" }, item),
              h("div", { class: "flex gap-1 flex-wrap" },
                Array.from({ length: 11 }).map((_, score) =>
                  h("button", {
                    key: score,
                    class: `px-2 py-1 rounded border text-sm ${scores[index] === score ? 'text-white' : ''}`,
                    style: { backgroundColor: `hsl(${score * 12}, 85%, ${scores[index] === score ? '45%' : '85%'})` },
                    onClick: () => handleChange(index, score)
                  }, score)
                )
              )
            )
          ),
          h("button", {
            class: "mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",
            onClick: () => setSubmitted(true)
          }, "é€å‡ºè©•é‡")
        ),
        submitted && h("div", { class: "bg-white p-4 rounded shadow", ref: resultRef },
          h("h2", { class: "text-xl font-semibold" }, "è©•é‡çµæœ"),
          h("p", null, `å­¸ç”Ÿï¼š${studentName}`),
          h("p", null, `ç¸½åˆ†ï¼š${totalScore}`),
          h("p", null, `ç­‰ç´šï¼š${getLevel(totalScore)}`),
          h("p", null, getNextLevelGap(totalScore)),
          h("p", null, `â­ å¼·é …æŠ€èƒ½ï¼š${summary.topSkills.join('ã€')}`),
          summary.isExcellent && h("p", { class: "text-green-600 font-semibold" }, "â­â­â­ ä½ çš„æ•´é«”åŒ¹å…‹çƒæŠ€èƒ½éå¸¸å„ªç§€ï¼"),
          h("p", null, `ğŸ”§ éœ€åŠ å¼·æŠ€èƒ½ï¼š${summary.weakSkills.length > 0 ? summary.weakSkills.join('ã€') : 'ç„¡æ˜é¡¯å¼±é …'}`),
          h("ul", { class: "list-disc list-inside text-sm mt-2" },
            ["135â€“150 åˆ†ï¼šç´„ 4.0 ç´š", "120â€“134 åˆ†ï¼šç´„ 3.5 ç´š", "100â€“119 åˆ†ï¼šç´„ 3.0 ç´š", "80â€“99 åˆ†ï¼šç´„ 2.5 ç´š", "0â€“79 åˆ†ï¼šç´„ 2.0 ä»¥ä¸‹"].map((item, i) => h("li", { key: i }, item))
          ),
          h("button", {
            class: "mt-4 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600",
            onClick: handleShareScreenshot
          }, "ğŸ“¸ åˆ†äº«çµæœæˆªåœ–è‡³ LINE å¥½å‹")
        )
      );
    }

    render(h(App), document.getElementById("app"));
  </script>
</body>
</html>
